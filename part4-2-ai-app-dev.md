# VMware Private AI Foundation 완벽 가이드 - Part 4-2
## AI 앱 개발 이해 (8장)

> **문서 버전:** 3.1 (v3.1 업데이트)  
> **기반 버전:** VCF 9.0.1, PAIF 9.0, PAIS 2.0.89, DLVM 9.0.1

---

## 8. AI 앱 개발 이해

이 장에서는 PAIF 환경에서 AI 애플리케이션을 개발할 때 알아야 할 핵심 개념과 아키텍처를 설명합니다. 인프라 담당자와 솔루션 아키텍트가 개발팀과 협업하거나, 고객에게 전체 그림을 설명할 때 필요한 관점을 제공합니다.

> **💡 핵심 전제:** PAIS는 별도 솔루션이 아니라 **PAIF에 포함된 모듈**입니다. PAIF 라이선스에 PAIS가 포함되어 있으므로, AI 플레이그라운드에서 PAIS를 활용한 개발이 **기본 권장 방식**입니다.

### 8.1 일반 웹앱 vs AI 앱 구조 비교

#### 8.1.1 전통적인 웹 애플리케이션 구조

전통적인 웹 애플리케이션은 Frontend, Backend, Database로 구성된 **3-Tier 아키텍처**를 따릅니다.

\`\`\`
┌─────────────────────────────────────────────────────────────────────────────┐
│                      전통적인 웹 애플리케이션 구조                            │
│                                                                             │
│   [사용자]                                                                   │
│      │                                                                      │
│      │ HTTP Request                                                         │
│      ▼                                                                      │
│   ┌─────────────────┐      ┌─────────────────┐      ┌─────────────────┐   │
│   │   Frontend      │      │   Backend       │      │   Database      │   │
│   │   (Presentation)│ ───▶ │   (Business)    │ ───▶ │   (Data)        │   │
│   │                 │      │                 │      │                 │   │
│   │ • React/Vue     │      │ • Spring Boot   │      │ • PostgreSQL    │   │
│   │ • HTML/CSS/JS   │      │ • Node.js       │      │ • MySQL         │   │
│   │ • 사용자 입력   │      │ • 비즈니스 로직 │      │ • MongoDB       │   │
│   │ • 화면 렌더링   │      │ • CRUD 처리     │      │ • 정형 데이터   │   │
│   └─────────────────┘      └─────────────────┘      └─────────────────┘   │
│                                                                             │
│   특징:                                                                     │
│   • 요청-응답이 결정적 (Deterministic)                                      │
│   • 동일 입력 → 동일 출력                                                   │
│   • 비즈니스 로직이 명시적으로 코딩됨                                        │
│   • 응답 시간이 빠르고 예측 가능 (ms 단위)                                  │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
\`\`\`

#### 8.1.2 AI 애플리케이션 구조

AI 애플리케이션은 전통적인 3-Tier에 **AI 서비스 계층**이 추가된 구조입니다.

\`\`\`
┌─────────────────────────────────────────────────────────────────────────────┐
│                        AI 애플리케이션 구조                                  │
│                                                                             │
│   [사용자]                                                                   │
│      │                                                                      │
│      │ HTTP Request                                                         │
│      ▼                                                                      │
│   ┌─────────────────┐      ┌─────────────────┐      ┌─────────────────┐   │
│   │   Frontend      │      │   Backend       │      │   Database      │   │
│   │   (Presentation)│ ───▶ │   (BFF/API)     │ ───▶ │   (Data)        │   │
│   │                 │      │                 │      │                 │   │
│   │ • React/Vue     │      │ • FastAPI       │      │ • PostgreSQL    │   │
│   │ • 채팅 UI       │      │ • Node.js       │      │ • 사용자 정보   │   │
│   │ • 스트리밍 응답 │      │ • 인증/인가     │      │ • 대화 이력     │   │
│   │ • 파일 업로드   │      │ • 세션 관리     │      │                 │   │
│   └─────────────────┘      └────────┬────────┘      └─────────────────┘   │
│                                     │                                      │
│                                     │ AI API 호출                          │
│                                     ▼                                      │
│                      ┌───────────────────────────────┐                    │
│                      │      AI Services (PAIS)       │                    │
│                      │                               │                    │
│                      │  ┌─────────────────────────┐  │                    │
│                      │  │  Agent API              │  │                    │
│                      │  │  (RAG 파이프라인)       │  │                    │
│                      │  │                         │  │                    │
│                      │  │  • 질문 이해            │  │                    │
│                      │  │  • 문서 검색 (KB)       │  │                    │
│                      │  │  • 답변 생성 (LLM)      │  │                    │
│                      │  │  • 출처 제공            │  │                    │
│                      │  └─────────────────────────┘  │                    │
│                      │                               │                    │
│                      └───────────────────────────────┘                    │
│                                                                             │
│   특징:                                                                     │
│   • 요청-응답이 확률적 (Probabilistic)                                      │
│   • 동일 입력 → 유사하지만 다른 출력 가능                                   │
│   • AI 모델이 "추론"을 통해 응답 생성                                       │
│   • 응답 시간이 상대적으로 길고 가변적 (초 단위)                            │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
\`\`\`

#### 8.1.3 핵심 차이점

| 관점 | 전통적 웹앱 | AI 앱 |
|------|-----------|-------|
| **응답 특성** | 결정적 (Deterministic) | 확률적 (Probabilistic) |
| **로직 구현** | 코드로 명시적 작성 | 모델이 학습된 패턴으로 추론 |
| **응답 시간** | 빠름, 예측 가능 (ms) | 느림, 가변적 (초) |
| **리소스** | CPU 중심 | GPU 필수 (LLM 추론) |
| **데이터 흐름** | 정형 데이터 CRUD | 비정형 데이터 → 벡터 → 추론 |
| **에러 처리** | 명확한 예외 처리 | 환각(Hallucination) 관리 필요 |
| **테스트** | 단위/통합 테스트 | 품질 평가 (정확도, 관련성) |

> **💡 인프라 관점:** AI 앱은 GPU 리소스가 필수이며, 응답 시간이 초 단위로 길어지므로 타임아웃 설정, 비동기 처리, 스트리밍 응답 등을 고려해야 합니다.

---

### 8.2 AI 앱의 계층별 역할

#### 8.2.1 4-Tier 아키텍처 개념

AI 애플리케이션은 **Frontend → Backend → AI Service → Infrastructure** 4개 계층으로 구성됩니다.

\`\`\`
┌─────────────────────────────────────────────────────────────────────────────┐
│                      AI 앱 4-Tier 아키텍처                                   │
│                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │ Tier 1: Presentation (Frontend)                                     │   │
│  │                                                                     │   │
│  │ 역할: 사용자 인터페이스, 입력 수집, 응답 표시                        │   │
│  │ 기술: React, Vue, Next.js, Mobile App                               │   │
│  │ 특징: AI 특화 UI (채팅창, 스트리밍, 출처 표시, 피드백 버튼)         │   │
│  │ 담당: App Developer (Frontend)                                       │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                      │                                      │
│                                      ▼                                      │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │ Tier 2: Business Logic (Backend / BFF)                              │   │
│  │                                                                     │   │
│  │ 역할: 인증/인가, 세션 관리, 비즈니스 규칙, AI API 중계              │   │
│  │ 기술: FastAPI, Node.js, Spring Boot                                 │   │
│  │ 특징: AI API 호출 전후 처리 (로깅, 필터링, 비용 추적)               │   │
│  │ 담당: App Developer (Backend)                                        │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                      │                                      │
│                                      ▼                                      │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │ Tier 3: AI Service (PAIS)                                           │   │
│  │                                                                     │   │
│  │ 역할: LLM 추론, RAG 처리, Knowledge 검색, 응답 생성                 │   │
│  │ 기술: Model Endpoint (vLLM), Agent (RAG), Knowledge Base            │   │
│  │ 특징: PAIF에 포함된 관리형 서비스, OpenAI 호환 API                  │   │
│  │ 담당: Data Scientist (Agent 구성), MLOps (Endpoint 관리)            │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                      │                                      │
│                                      ▼                                      │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │ Tier 4: Infrastructure (PAIF / VCF)                                 │   │
│  │                                                                     │   │
│  │ 역할: GPU 리소스, 컨테이너 오케스트레이션, 스토리지, 네트워킹       │   │
│  │ 기술: VCF, Supervisor, VKS, vGPU, Harbor, DSM                       │   │
│  │ 특징: 엔터프라이즈급 인프라, 멀티테넌시, 보안                       │   │
│  │ 담당: VI Admin, Platform Engineer                                   │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
\`\`\`

#### 8.2.2 계층별 책임 분리

| 계층 | 책임 | PAIS가 담당 | 개발팀이 담당 |
|------|------|------------|--------------|
| **Frontend** | UI/UX, 사용자 경험 | ❌ | ✅ 전체 |
| **Backend** | 비즈니스 로직, 인증 | ❌ | ✅ 전체 |
| **AI Service** | LLM 추론, RAG | ✅ Agent/Endpoint | 프롬프트, KB 구성 |
| **Infrastructure** | GPU, 컴퓨팅 | ✅ 자동 프로비저닝 | ❌ |

> **💡 핵심 이해:** PAIS는 **Tier 3 (AI Service)**를 담당합니다. 개발팀은 Tier 1-2에 집중하고, AI 로직은 PAIS Agent API를 호출하여 처리합니다.

#### 8.2.3 "PAIS Agent = AI 두뇌" 개념

PAIS Agent가 제공하는 것과 개발팀이 구현해야 하는 것의 경계를 명확히 이해해야 합니다.

\`\`\`
┌─────────────────────────────────────────────────────────────────────────────┐
│                    PAIS Agent vs 앱 개발 영역                               │
│                                                                             │
│   ┌───────────────────────────────────────┐   ┌───────────────────────────┐│
│   │         PAIS가 제공 (AI 두뇌)         │   │   개발팀이 구현 (앱 몸체) ││
│   │                                       │   │                           ││
│   │  ✅ LLM 추론 (Completion Endpoint)    │   │  ✅ 사용자 인증/인가       ││
│   │  ✅ 벡터 검색 (Knowledge Base)        │   │  ✅ 사용자 인터페이스      ││
│   │  ✅ RAG 파이프라인 (Agent)            │   │  ✅ 비즈니스 로직          ││
│   │  ✅ 세션 관리 (대화 히스토리)         │   │  ✅ 대화 이력 저장 (DB)    ││
│   │  ✅ OpenAI 호환 API                   │   │  ✅ 사용량 추적/과금       ││
│   │  ✅ 출처 정보 반환                    │   │  ✅ 에러 핸들링            ││
│   │  ✅ 자동 스케일링                     │   │  ✅ 로깅/모니터링 확장     ││
│   │                                       │   │  ✅ CI/CD 파이프라인       ││
│   │  ❌ 사용자 관리                       │   │                           ││
│   │  ❌ 비즈니스 규칙                     │   │                           ││
│   │  ❌ 커스텀 UI                         │   │                           ││
│   │                                       │   │                           ││
│   └───────────────────────────────────────┘   └───────────────────────────┘│
│                                                                             │
│   비유: PAIS Agent = "AI 전문가 직원"                                       │
│         앱 = "회사 시스템" (출입, 업무 규칙, 보고 체계 등)                  │
│                                                                             │
│         회사는 AI 전문가에게 질문하고 답변을 받지만,                        │
│         누가 질문할 수 있는지, 답변을 어떻게 활용할지는 회사가 결정         │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
\`\`\`

---

### 8.3 PAIS API 연동 개념

#### 8.3.1 PAIS API 유형

PAIS는 두 가지 주요 API를 제공합니다:

| API 유형 | 용도 | 엔드포인트 | 사용 시나리오 |
|---------|------|-----------|--------------|
| **Model Endpoint API** | 단순 LLM 추론 | \`/v1/chat/completions\` | RAG 없이 직접 LLM 호출 |
| **Agent API** | RAG 통합 추론 | \`/v1/agents/{name}/chat\` | KB 기반 Q&A (권장) |

\`\`\`
┌─────────────────────────────────────────────────────────────────────────────┐
│                      PAIS API 비교                                          │
│                                                                             │
│   ┌─────────────────────────────────┐   ┌─────────────────────────────────┐│
│   │     Model Endpoint API          │   │         Agent API               ││
│   │                                 │   │                                 ││
│   │  POST /v1/chat/completions      │   │  POST /v1/agents/{name}/chat    ││
│   │                                 │   │                                 ││
│   │  입력:                          │   │  입력:                          ││
│   │  • messages (대화 이력)         │   │  • message (사용자 질문)        ││
│   │  • model (모델명)               │   │  • session_id (세션 식별자)     ││
│   │  • temperature, max_tokens      │   │                                 ││
│   │                                 │   │                                 ││
│   │  출력:                          │   │  출력:                          ││
│   │  • 생성된 텍스트                │   │  • 생성된 답변                  ││
│   │                                 │   │  • 참조 문서 (출처)             ││
│   │                                 │   │  • session_id                   ││
│   │                                 │   │                                 ││
│   │  특징:                          │   │  특징:                          ││
│   │  • OpenAI API 완전 호환         │   │  • RAG 자동 처리                ││
│   │  • 대화 이력 직접 관리 필요     │   │  • 세션/대화 이력 자동 관리     ││
│   │  • RAG 없음 (직접 구현 필요)    │   │  • Knowledge Base 연결됨        ││
│   │                                 │   │                                 ││
│   │  용도:                          │   │  용도:                          ││
│   │  • 커스텀 RAG 구현 시           │   │  • 일반적인 RAG 앱 (권장)       ││
│   │  • 단순 챗봇 (KB 불필요)        │   │  • 문서 기반 Q&A                ││
│   │  • 시나리오 C (하이브리드)      │   │  • 시나리오 B (PAIS 전면)       ││
│   │                                 │   │                                 ││
│   └─────────────────────────────────┘   └─────────────────────────────────┘│
│                                                                             │
│   💡 권장: 대부분의 경우 Agent API 사용                                     │
│      RAG 로직을 직접 구현할 필요 없이 즉시 문서 기반 Q&A 가능               │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
\`\`\`

#### 8.3.2 인증 흐름

PAIS API 호출에는 인증이 필요합니다. VCF의 OIDC 기반 인증을 사용합니다.

\`\`\`
┌─────────────────────────────────────────────────────────────────────────────┐
│                      PAIS API 인증 흐름                                     │
│                                                                             │
│   ┌─────────────┐                                                           │
│   │   앱        │                                                           │
│   │  (Backend)  │                                                           │
│   └──────┬──────┘                                                           │
│          │                                                                  │
│          │ ① Token 요청 (Client Credentials)                               │
│          │    POST /oauth/token                                             │
│          │    { client_id, client_secret, grant_type }                     │
│          ▼                                                                  │
│   ┌─────────────────────┐                                                   │
│   │   VCF Automation    │                                                   │
│   │   (OIDC Provider)   │                                                   │
│   └──────┬──────────────┘                                                   │
│          │                                                                  │
│          │ ② Access Token 반환                                              │
│          │    { access_token, expires_in, token_type }                     │
│          ▼                                                                  │
│   ┌─────────────┐                                                           │
│   │   앱        │                                                           │
│   │  (Backend)  │                                                           │
│   └──────┬──────┘                                                           │
│          │                                                                  │
│          │ ③ PAIS API 호출 (Bearer Token)                                  │
│          │    POST /v1/agents/{name}/chat                                   │
│          │    Authorization: Bearer {access_token}                          │
│          ▼                                                                  │
│   ┌─────────────────────┐                                                   │
│   │   PAIS               │                                                   │
│   │   (ML API Gateway)  │                                                   │
│   └──────┬──────────────┘                                                   │
│          │                                                                  │
│          │ ④ 응답 반환                                                      │
│          │    { response, references, session_id }                         │
│          ▼                                                                  │
│   ┌─────────────┐                                                           │
│   │   앱        │                                                           │
│   │  (Backend)  │                                                           │
│   └─────────────┘                                                           │
│                                                                             │
│   💡 토큰 관리 팁:                                                          │
│   • Access Token은 만료 시간이 있음 (보통 1시간)                           │
│   • 만료 전 갱신 로직 구현 필요                                             │
│   • Backend에서 토큰 관리, Frontend에 노출 금지                            │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
\`\`\`

#### 8.3.3 API 호출 패턴

**Agent API 호출 예시 (curl):**

\`\`\`bash
# Agent API 호출
curl -X POST 'https://pais.company.com/v1/agents/hr-assistant/chat' \
  -H 'Authorization: Bearer <access_token>' \
  -H 'Content-Type: application/json' \
  -d '{
    "message": "연차 휴가는 며칠인가요?",
    "session_id": "user-123-session-456"
  }'
\`\`\`

**응답 구조:**

\`\`\`json
{
  "response": "회사 휴가 정책에 따르면, 정규직 직원은 연간 15일의 연차 휴가가 부여됩니다...",
  "references": [
    {
      "source": "HR_Policy_2026.pdf",
      "page": 12,
      "content": "정규직 직원의 연차 휴가는 연간 15일이며..."
    }
  ],
  "session_id": "user-123-session-456"
}
\`\`\`

> **💡 개발팀 전달 정보:** MLOps/Data Scientist가 Agent 생성 후 다음 정보를 App Developer에게 전달합니다:
> - PAIS Base URL
> - Agent Name
> - 인증 정보 (Client ID/Secret 또는 Token Endpoint)
> - 사용 가이드 (세션 관리, 타임아웃 권장값 등)

---

### 8.4 배포 아키텍처

#### 8.4.1 AI 앱 배포 위치

AI 애플리케이션은 **VKS(VMware Kubernetes Service) 클러스터**에 배포하는 것이 권장됩니다.

\`\`\`
┌─────────────────────────────────────────────────────────────────────────────┐
│                      AI 앱 배포 아키텍처                                     │
│                                                                             │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │                    AI 플레이그라운드 (PAIF/PAIS)                     │  │
│   │                                                                     │  │
│   │   [외부 사용자]                                                     │  │
│   │        │                                                            │  │
│   │        │ HTTPS                                                      │  │
│   │        ▼                                                            │  │
│   │   ┌────────────────────────────────────────────────────────────┐   │  │
│   │   │                 VKS Cluster (프로덕션)                      │   │  │
│   │   │                                                            │   │  │
│   │   │   ┌──────────────┐                                        │   │  │
│   │   │   │   Ingress    │  L7 로드 밸런싱, TLS 종료              │   │  │
│   │   │   │   Controller │                                        │   │  │
│   │   │   └──────┬───────┘                                        │   │  │
│   │   │          │                                                 │   │  │
│   │   │          ▼                                                 │   │  │
│   │   │   ┌──────────────┐      ┌──────────────┐                 │   │  │
│   │   │   │  Frontend    │      │  Backend     │                 │   │  │
│   │   │   │  Pod(s)      │ ───▶ │  Pod(s)      │                 │   │  │
│   │   │   │              │      │              │                 │   │  │
│   │   │   │  • React     │      │  • FastAPI   │                 │   │  │
│   │   │   │  • Nginx     │      │  • 인증 처리 │                 │   │  │
│   │   │   │              │      │  • AI API 중계│                │   │  │
│   │   │   └──────────────┘      └──────┬───────┘                 │   │  │
│   │   │                                │                          │   │  │
│   │   └────────────────────────────────┼──────────────────────────┘   │  │
│   │                                    │                              │  │
│   │                                    │ PAIS API 호출                │  │
│   │                                    ▼                              │  │
│   │   ┌────────────────────────────────────────────────────────────┐ │  │
│   │   │                    PAIS Services                           │ │  │
│   │   │                                                            │ │  │
│   │   │   ┌──────────────┐   ┌──────────────┐   ┌──────────────┐ │ │  │
│   │   │   │ Agent API    │   │ Model        │   │ Knowledge    │ │ │  │
│   │   │   │              │   │ Endpoints    │   │ Base         │ │ │  │
│   │   │   └──────────────┘   └──────────────┘   └──────────────┘ │ │  │
│   │   │                                                            │ │  │
│   │   └────────────────────────────────────────────────────────────┘ │  │
│   │                                                                     │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│                                                                             │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │                         공유 서비스                                  │  │
│   │   • Harbor: 컨테이너 이미지 저장소                                  │  │
│   │   • DSM: PostgreSQL (앱 데이터, 사용자 정보)                        │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
\`\`\`

#### 8.4.2 배포 방식 비교

| 배포 방식 | 설명 | 장점 | 단점 | 권장 상황 |
|----------|------|------|------|----------|
| **VKS 배포** | Kubernetes에 컨테이너로 배포 | 스케일링, 롤링 업데이트, 고가용성 | 초기 설정 복잡 | 프로덕션 |
| **DLVM 직접 실행** | DLVM 내에서 직접 서비스 실행 | 빠른 테스트 가능 | 스케일링 어려움, 단일 장애점 | 개발/PoC |
| **외부 배포** | 플레이그라운드 외부에 배포 | 기존 인프라 활용 | 네트워크 설정 복잡 | 특수한 경우 |

> **💡 권장:** 개발/테스트는 DLVM에서 진행하고, 프로덕션은 VKS에 배포합니다.

#### 8.4.3 컨테이너화 개념

프로덕션 배포를 위해 앱을 컨테이너 이미지로 패키징합니다.

\`\`\`
┌─────────────────────────────────────────────────────────────────────────────┐
│                      컨테이너화 및 배포 흐름                                 │
│                                                                             │
│   [개발자 PC / CI 서버]                                                     │
│         │                                                                   │
│         │ ① 코드 작성 및 Dockerfile 준비                                   │
│         │                                                                   │
│         │ ② docker build                                                   │
│         │    이미지 빌드                                                    │
│         ▼                                                                   │
│   ┌─────────────┐                                                           │
│   │  Container  │                                                           │
│   │  Image      │                                                           │
│   │  (로컬)     │                                                           │
│   └──────┬──────┘                                                           │
│          │                                                                  │
│          │ ③ docker push                                                   │
│          │    Harbor에 이미지 업로드                                        │
│          ▼                                                                  │
│   ┌─────────────────────┐                                                   │
│   │   Harbor Registry   │                                                   │
│   │   (이미지 저장소)   │                                                   │
│   │                     │                                                   │
│   │   • Frontend 이미지 │                                                   │
│   │   • Backend 이미지  │                                                   │
│   │   • 버전 태그 관리  │                                                   │
│   └──────┬──────────────┘                                                   │
│          │                                                                  │
│          │ ④ kubectl apply / helm install                                  │
│          │    VKS에 배포                                                    │
│          ▼                                                                  │
│   ┌─────────────────────┐                                                   │
│   │   VKS Cluster       │                                                   │
│   │                     │                                                   │
│   │   Pod 생성 및 실행  │                                                   │
│   │   서비스 노출       │                                                   │
│   └─────────────────────┘                                                   │
│                                                                             │
│   💡 CI/CD 자동화:                                                          │
│   • Git Push → 자동 빌드 → 자동 배포 파이프라인 구성 가능                  │
│   • GitLab CI, Jenkins, GitHub Actions 등 활용                             │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
\`\`\`

#### 8.4.4 VKS 배포 시 필요한 리소스

| Kubernetes 리소스 | 용도 | 설명 |
|------------------|------|------|
| **Deployment** | 앱 Pod 관리 | Replicas, 롤링 업데이트 정의 |
| **Service** | 내부 네트워킹 | Pod 간 통신, ClusterIP |
| **Ingress** | 외부 노출 | L7 라우팅, TLS, 도메인 매핑 |
| **ConfigMap** | 설정 관리 | 환경 변수, 설정 파일 |
| **Secret** | 민감 정보 | API 키, 인증 정보 |
| **PVC** | 영구 스토리지 | 파일 업로드 저장 (필요시) |

---

### 8.5 운영 고려사항

#### 8.5.1 모니터링

AI 앱 운영 시 모니터링해야 할 핵심 지표:

\`\`\`
┌─────────────────────────────────────────────────────────────────────────────┐
│                      AI 앱 모니터링 영역                                     │
│                                                                             │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │                    앱 레벨 (개발팀 담당)                             │  │
│   │                                                                     │  │
│   │   • 요청 수 / 응답 시간 (P50, P95, P99)                            │  │
│   │   • 에러율 (5xx, 4xx)                                              │  │
│   │   • 동시 사용자 수                                                  │  │
│   │   • API 호출 패턴 (시간대별)                                        │  │
│   │                                                                     │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│                                                                             │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │                    AI 서비스 레벨 (PAIS 제공)                        │  │
│   │                                                                     │  │
│   │   • Model Endpoint 응답 시간                                        │  │
│   │   • 토큰 사용량 (Input/Output)                                      │  │
│   │   • Agent 호출 수                                                   │  │
│   │   • Knowledge Base 검색 품질 (Similarity Score 분포)                │  │
│   │                                                                     │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│                                                                             │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │                    인프라 레벨 (플랫폼팀 담당)                        │  │
│   │                                                                     │  │
│   │   • GPU 사용률 (DCGM Exporter)                                      │  │
│   │   • GPU 메모리 사용량                                               │  │
│   │   • VKS 클러스터 리소스 (CPU, Memory)                               │  │
│   │   • Pod 상태 및 재시작 횟수                                         │  │
│   │                                                                     │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│                                                                             │
│   도구:                                                                     │
│   • VCF Operations (Aria Operations): 인프라 모니터링                      │
│   • Prometheus + Grafana: 커스텀 메트릭                                    │
│   • 앱 로그: ELK Stack, Loki 등                                           │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
\`\`\`

#### 8.5.2 보안 고려사항

| 영역 | 고려사항 | 권장 방안 |
|------|---------|----------|
| **인증/인가** | API 접근 제어 | OIDC 토큰 기반, RBAC 적용 |
| **데이터 보호** | 민감 정보 노출 방지 | 입력/출력 필터링, PII 마스킹 |
| **네트워크** | 통신 암호화 | TLS 필수, 내부 통신도 암호화 권장 |
| **프롬프트 인젝션** | 악의적 입력 방어 | 입력 검증, 샌드박싱 |
| **모델 보안** | 모델 탈취 방지 | Harbor 접근 제어, 네트워크 격리 |
| **감사 로깅** | 규정 준수 | 모든 API 호출 로깅, 보관 정책 |

> **⚠️ 프롬프트 인젝션 주의:** 사용자 입력이 그대로 LLM에 전달되면, 악의적 사용자가 시스템 프롬프트를 우회하거나 의도치 않은 동작을 유발할 수 있습니다. 입력 검증과 샌드박싱이 필요합니다.

#### 8.5.3 비용 고려사항

\`\`\`
┌─────────────────────────────────────────────────────────────────────────────┐
│                      AI 앱 비용 구성 요소                                    │
│                                                                             │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │                    GPU 리소스 비용 (가장 큰 비중)                    │  │
│   │                                                                     │  │
│   │   • Model Endpoint 실행에 GPU 필수                                  │  │
│   │   • Replicas 수에 따라 비례 증가                                    │  │
│   │   • 유휴 시간에도 할당되면 비용 발생                                │  │
│   │                                                                     │  │
│   │   최적화 방안:                                                      │  │
│   │   • 적절한 모델 크기 선택 (8B vs 70B)                              │  │
│   │   • 자동 스케일링 활용 (최소 Replicas 조정)                        │  │
│   │   • 개발/테스트는 작은 모델 사용                                    │  │
│   │   • Embedding은 CPU 전용 가능 (Infinity)                           │  │
│   │                                                                     │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│                                                                             │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │                    스토리지 비용                                     │  │
│   │                                                                     │  │
│   │   • Harbor: 모델 이미지 저장 (수십 GB/모델)                         │  │
│   │   • pgvector: 벡터 데이터 저장 (문서 규모에 비례)                   │  │
│   │   • 앱 데이터: 대화 이력, 사용자 데이터                             │  │
│   │                                                                     │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│                                                                             │
│   ┌─────────────────────────────────────────────────────────────────────┐  │
│   │                    컴퓨팅 비용 (앱 레벨)                             │  │
│   │                                                                     │  │
│   │   • VKS 클러스터 노드 (CPU/Memory)                                  │  │
│   │   • 상대적으로 작은 비중                                            │  │
│   │                                                                     │  │
│   └─────────────────────────────────────────────────────────────────────┘  │
│                                                                             │
│   💡 비용 최적화 핵심:                                                      │
│   • GPU 사용량 모니터링 후 적정 Replicas 조정                              │
│   • 개발/테스트 환경은 소형 모델 사용                                       │
│   • Knowledge Base 갱신 주기 최적화 (과도한 재인덱싱 방지)                 │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
\`\`\`

#### 8.5.4 성능 최적화 팁

| 영역 | 문제 | 최적화 방안 |
|------|------|------------|
| **응답 시간** | LLM 추론이 느림 (수 초) | 스트리밍 응답 활용, 사용자에게 진행 상태 표시 |
| **동시 처리** | 많은 요청 시 병목 | Model Endpoint Replicas 증가, 자동 스케일링 |
| **검색 품질** | RAG 결과가 부정확 | Chunk 크기 조정, Similarity Cutoff 튜닝 |
| **대화 맥락** | 긴 대화 시 맥락 손실 | Chat History Length 조정, 요약 기법 적용 |
| **첫 응답** | Cold Start 지연 | 최소 Replicas 1 이상 유지, 워밍업 요청 (Cold Start의 상세 원인과 완화 전략은 Part 5 9.5.3절 참조) |

---

### 8.6 개발 환경 vs 프로덕션 환경

#### 8.6.1 환경별 차이

| 항목 | 개발/테스트 | 프로덕션 |
|------|------------|----------|
| **배포 위치** | DLVM 직접 실행 | VKS 클러스터 |
| **모델 크기** | 소형 (8B) | 요구사항에 맞게 선택 |
| **Replicas** | 1 (최소) | 2+ (고가용성) |
| **스케일링** | 수동 | 자동 스케일링 |
| **모니터링** | 기본 로그 | 전체 스택 모니터링 |
| **보안** | 내부망 | TLS, 인증 강화, 감사 로깅 |
| **데이터** | 테스트 데이터 | 실제 데이터 (백업 필수) |

#### 8.6.2 환경 전환 체크리스트

\`\`\`
┌─────────────────────────────────────────────────────────────────────────────┐
│                    개발 → 프로덕션 전환 체크리스트                            │
│                                                                             │
│   ☐ 컨테이너 이미지                                                         │
│      • Dockerfile 최적화 (멀티스테이지 빌드)                                │
│      • 이미지 크기 최소화                                                   │
│      • Harbor에 Push 완료                                                   │
│                                                                             │
│   ☐ Kubernetes 매니페스트                                                   │
│      • Deployment, Service, Ingress 정의                                    │
│      • Resource Limits/Requests 설정                                        │
│      • Health Check (Liveness, Readiness) 설정                             │
│                                                                             │
│   ☐ 설정 관리                                                               │
│      • ConfigMap으로 환경별 설정 분리                                       │
│      • Secret으로 민감 정보 관리                                            │
│      • 환경 변수 정리                                                       │
│                                                                             │
│   ☐ 보안                                                                    │
│      • TLS 인증서 적용                                                      │
│      • 인증/인가 테스트 완료                                                │
│      • 네트워크 정책 검토                                                   │
│                                                                             │
│   ☐ 모니터링/로깅                                                           │
│      • 로그 수집 설정                                                       │
│      • 메트릭 대시보드 구성                                                 │
│      • 알림 규칙 정의                                                       │
│                                                                             │
│   ☐ 성능/부하 테스트                                                        │
│      • 예상 트래픽 기준 부하 테스트                                         │
│      • 응답 시간 SLA 확인                                                   │
│      • 스케일링 동작 검증                                                   │
│                                                                             │
│   ☐ 백업/복구                                                               │
│      • 데이터 백업 정책 수립                                                │
│      • 복구 절차 문서화 및 테스트                                           │
│      • (상세한 HA/DR 설계는 Part 5 9장 참조)                               │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
\`\`\`

---

### 8.7 정리: AI 앱 개발의 핵심 포인트

\`\`\`
┌─────────────────────────────────────────────────────────────────────────────┐
│                    AI 앱 개발 핵심 요약                                      │
│                                                                             │
│   1️⃣ PAIS 활용이 기본                                                       │
│      • PAIS는 PAIF에 포함된 모듈 (별도 라이선스 불필요)                     │
│      • Agent API로 RAG 기능 즉시 사용 가능                                  │
│      • 개발팀은 AI 로직 구현 없이 API 호출에 집중                           │
│                                                                             │
│   2️⃣ 역할 분담 명확화                                                       │
│      • PAIS: AI 두뇌 (LLM, RAG, 세션 관리)                                  │
│      • 개발팀: 앱 몸체 (UI, 인증, 비즈니스 로직)                            │
│      • 인프라팀: 플레이그라운드 환경 제공                                   │
│                                                                             │
│   3️⃣ 계층 구조 이해                                                         │
│      • Frontend → Backend → PAIS → Infrastructure                          │
│      • 각 계층의 책임과 담당자 명확히                                       │
│                                                                             │
│   4️⃣ 개발-프로덕션 경로                                                     │
│      • 개발: DLVM + PAIS Playground에서 반복 실험                           │
│      • 프로덕션: VKS에 컨테이너로 배포                                      │
│      • PAIS Agent는 이미 프로덕션 준비 상태                                 │
│                                                                             │
│   5️⃣ 운영 고려사항                                                          │
│      • 모니터링: 앱/AI/인프라 3개 레벨                                      │
│      • 보안: 인증, 프롬프트 인젝션, 감사 로깅                               │
│      • 비용: GPU 리소스가 핵심, 적정 크기 선택                              │
│      • HA/DR: 프로덕션 필수 (Part 5 9장에서 상세 설계 가이드 제공)          │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
\`\`\`

---

**[Part 4-2 완료]**

다음 Part에서 다루는 추가 주제:
- **Part 5 (9장):** 프로덕션 아키텍처 패턴 (HA, DR, 멀티사이트, Cold Start 최적화)
- 10장: FAQ 및 트러블슈팅
- 부록: 버전 호환성 매트릭스, 용어집
